#gcc version
CC  = gcc
CXX = g++
GCCVER := $(shell $(CC) -dumpversion | awk -F. '{ print $$1"."$$2}' )

################################################################################
# 包含的makefile文件                                                             #
################################################################################

################################################################################
# 编译操作                                                                      #
################################################################################
CFLAGS = -g -fPIC -Wall -fno-strict-aliasing -Wsign-compare -pipe -fno-ident -MMD \
-std=c++0x
################################################################################
# 编译操作                                                                      #
################################################################################
USER_MARCOS +=
CFLAGS += $(addprefix -D,$(USER_MARCOS))

################################################################################
# 目标文件                                                                      #
################################################################################
TARGET = $(patsubst %.cpp,%,$(SOURCE))

################################################################################
# 头文件路径                                                                    #
################################################################################
INC_PATH += ./
INC_PATH += /usr/local/include
INC_PATH += $(HOME_INC)

################################################################################
# 库文件路径                                                                    #
################################################################################
LIB_PATH += /usr/lib64
LIB_PATH += /usr/lib/
LIB_PATH += /usr/local/lib
LIB_PATH += $(HOME_LIB)

################################################################################
# 依赖的库                                                                      #
################################################################################
#LIB_STATIC  += proto

INC     = $(patsubst %, -I%,  $(INC_PATH))
LIBPATH = $(patsubst %, -L%,  $(LIB_PATH))
LIB     = $(LIBPATH) -Wl,-dn  $(patsubst %, -l%, $(LIB_STATIC)) -Wl,-dy $(patsubst %, -l%, $(LIB_DYNAMIC))
#LIB     = $(LIBPATH) $(patsubst %, -l%, $(LIB_STATIC)) $(patsubst %, -l%, $(LIB_DYNAMIC))

OBJ_DIR=./obj

################################################################################
# 源文件列表                                                                     #
################################################################################
SOURCE += $(wildcard *.cpp)
SOURCE += $(EX_SOURCE)

all : $(TARGET)
OBJ := $(patsubst %.cpp,%.o,$(SOURCE))

$(TARGET):%:%.o
	@echo -e $(BLUE) Compling $<$(RESET)...
	$(CXX) -o $@ $^ $(CFLAGS) $(LIB)
	@rm -f *.d *.o
%.o: %.cpp
	@echo -e $(GREEN) Compling $<$(RESET) ...
	$(CXX) $(INC) $(CFLAGS) -c -o $@ $<
%.o: %.c
	@echo -e $(GREEN) Compling $<$(RESET) ...
	$(CC) $(INC) $(CFLAGS) -c -o $@ $<
clean:
	@rm -f $(OBJ) $(TARGET)
	@rm -f *.d

